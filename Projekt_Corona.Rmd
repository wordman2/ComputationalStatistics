---
title: "Projekt Corona"
author: "Jonas Wortmann"
date: "2023-04-17"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

Wir wollen den Verlauf einer Infektion innerhalb einer homogenen
Population untersuchen. Hierzu verwenden wir das SIR Modell als
'stochastic individual contact model (ICM)', d.h. die Simulation
verläuft auf individueller Ebene mit stochastischen Übergängen von SIR.
Untersuchen Sie eine Population von N = 5000 Personen, von denen zum
Zeitpunkt t = 0, I = 10 Individuen bereits infiziert sind. Zu Beginn
soll es noch keine immunisierten Personen geben (R0 = 0). Wir gehen
davon aus, dass es bei einer Begegnung von einer infizierbaren zu einer
bereits infizierten Person mit einer Wahrscheinlichkeit von inf.prob =
10% zu einer Ansteckung kommt. Ferner gehen Sie von einer Begegnungsrate
einer infizierten Person zu infizierbaren Personen von act.rate = 10 pro
Tag aus. Die Zeit von einer Infektion bis zu einer Immunisierung betrage
14 Tage. Ferner gehen Sie bitte von einer Geburt in 100 Tagen so wie
einer Todesrate von jeweils einer von 90 Personen bei gesunden und
Immunen, bzw. von zwei von 90 Personen unter den infizierten aus.

### Simulation des Verlaufs der Verbreitung in 50 Tagen

```{r, message=FALSE,  warning=FALSE,}
library(EpiModel)
N <- 5000
I_0 <- 10 # bereits infizierte Personen zum Zeitpunkt t=0
R_0 <- 0 # Anzahl immunisierte Personen zum Zeitpunkt t=0
inf.prob <- 0.1 # Wahrscheinlichkeit einer Infektion
act.rate <- 10 # Begegnungsrate einer infizierten Person zu infizierbaren Person
rec.rate <- 1/14 # recovery rate
birth_rate <- 1/100
I.death_rate <- 2/90 # Todesrate einer infizierten Person
S.death_rate <- 1/90 # Todesrate einer gesunden Person
n <- 50 # Anzahl Tage der Simulation

#  stochastic individual contact model (SIR)
param <- param.icm(inf.prob=inf.prob,
          act.rate=act.rate,
          rec.rate=rec.rate,
          di.rate=I.death_rate,
          ds.rate=S.death_rate,
          dr.rate=S.death_rate,
          a.rate=birth_rate,
          )

init <- init.icm(s.num=(N-I_0), # Anzahl gesunde Personen zum Zeitpunkt t=0
         i.num=I_0,
         r.num=R_0,
        
         )

control <- control.icm(type="SIR", nsteps=n)

mod_a <- icm(param, init, control)

plot(mod_a)
```

### Hygienevorschriften

```{r}
inf.prob_5 <- 0.05
param <- param.icm(inf.prob=inf.prob_5,
          act.rate=act.rate,
          rec.rate=rec.rate,
          di.rate=I.death_rate,
          ds.rate=S.death_rate,
          dr.rate=S.death_rate,
          a.rate=birth_rate
          )

mod_b <- icm(param, init, control)

plot(mod_b, main="5% Ansteckungswahrscheinlichkeit")
plot(mod_a, main="10% Ansteckungswahrscheinlichkeit")
```

Durch die Maßnahmen flacht die Ansteckungskurve ab und geht langsamer
auf den Hochpunkt zu.

### Kontakteinschränkungen

```{r}
act.rate_5 <- 5
act.rate_2 <- 2
  
param <- param.icm(inf.prob=inf.prob,
          act.rate=act.rate_5,
          rec.rate=rec.rate,
          di.rate=I.death_rate,
          ds.rate=S.death_rate,
          dr.rate=S.death_rate,
          a.rate=birth_rate
          )

mod_c <- icm(param, init, control)

param <- param.icm(inf.prob=inf.prob,
          act.rate=act.rate_2,
          rec.rate=rec.rate,
          di.rate=I.death_rate,
          ds.rate=S.death_rate,
          dr.rate=S.death_rate,
          a.rate=birth_rate
          )

mod_d <- icm(param, init, control)



plot(mod_a, main="Begegnungsrate 10")
plot(mod_c, main="Begegnungsrate 5")
plot(mod_d, main="Begegnungsrate 2")
```

Analog zu b) flacht die Ansteckungskurve durch eine geringere
Begegnungsrate ab. Da sich weniger Infizierte mit nicht-Infizierten
begegnen ist die Wahrscheinlichkeit sich anzustecken geringer.

### Kontakteinschränkungen + Hygienevorschriften

```{r}
param <- param.icm(inf.prob=inf.prob_5,
          act.rate=act.rate_5,
          rec.rate=rec.rate,
          di.rate=I.death_rate,
          ds.rate=S.death_rate,
          dr.rate=S.death_rate,
          a.rate=birth_rate
          )
control_n_100 <- control.icm(type="SIR", nsteps=100) # um den Verlauf besser vergleichen zu können unter den zwei neuen Modellen wird jetzt auf 100 Tage simuliert
mod_e <- icm(param, init, control_n_100)

param <- param.icm(inf.prob=inf.prob_5,
          act.rate=act.rate_2,
          rec.rate=rec.rate,
          di.rate=I.death_rate,
          ds.rate=S.death_rate,
          dr.rate=S.death_rate,
          a.rate=birth_rate
          )
mod_f <- icm(param, init, control_n_100)

plot(mod_a, main="Begegnungsrate 10, Ansteckungswahrscheinlichkeit 10%")
plot(mod_c, main="Begegnungsrate 5, Ansteckungswahrscheinlichkeit 10%")
plot(mod_e, main="Begegnungsrate 5, Ansteckungswahrscheinlichkeit 5%")
plot(mod_f, main="Begegnungsrate 2, Ansteckungswahrscheinlichkeit 5%")

```

Weiterhin gilt, je geringer die Ansteckungswahrscheinlichkeit und
Begegnungsrate desto langsamer ist der Infektionsverlauf. Interessant
ist, dass bei einer Ansteckungswahrscheinlichkeit von 5% und
Begegnungsrate von 2 die Kurve so abflacht, dass man die Steigung der
Infektionszahl selbst nach 100 Tagen nicht wahrnimmt.

### Variation der Zeitpunkte tH und tK

```{r}
# source("custom_infection_fun.R")
# param_0.5_10d <- param.icm(inf.prob=inf.prob,
#           act.rate=act.rate,
#           rec.rate=rec.rate,
#           di.rate=I.death_rate,
#           ds.rate=S.death_rate,
#           dr.rate=S.death_rate,
#           a.rate=birth_rate,
#           inf.prob.new = 0.02, # neue Ansteckungswahrscheinlichkeit
#           inf.prob.new.start=5 # nach 5 Tagen
#           )
# 
# param_0.5_20d <- param.icm(inf.prob=inf.prob,
#           act.rate=act.rate,
#           rec.rate=rec.rate,
#           di.rate=I.death_rate,
#           ds.rate=S.death_rate,
#           dr.rate=S.death_rate,
#           a.rate=birth_rate,
#           inf.prob.new = 0.02, # neue Ansteckungswahrscheinlichkeit
#           inf.prob.new.start=20 # nach 20 Tagen
#           )
# 
# param_act_rate_5d <- param.icm(inf.prob=inf.prob,
#           act.rate=act.rate,
#           rec.rate=rec.rate,
#           di.rate=I.death_rate,
#           ds.rate=S.death_rate,
#           dr.rate=S.death_rate,
#           a.rate=birth_rate,
#           act.rate.new = 5, # Kontaktbeschränkungen
#           act.rate.new.start=5 # nach 5 Tagen
#           )
# 
# param_act_rate_5d_to_30d <- param.icm(inf.prob=inf.prob,
#           act.rate=act.rate,
#           rec.rate=rec.rate,
#           di.rate=I.death_rate,
#           ds.rate=S.death_rate,
#           dr.rate=S.death_rate,
#           a.rate=birth_rate,
#           act.rate.new = 5, # Kontaktbeschränkungen
#           act.rate.new.start=5, # nach 5 Tagen
#           act.rate.new.end=30 # Ende nach 30 Tagen
#           )
# 
# 
# 
# control <- control.icm(type="SIR", nsteps=n, infection.FUN = infection.icm_custom)
# 
# mod_a_maßnahmen_0.5_10d <- icm(param_0.5_10d, init, control)
# mod_a_maßnahmen_0.5_20d <- icm(param_0.5_20d, init, control)
# mod_a_maßnahmen_act_rate_5d <- icm(param_act_rate_5d, init, control)
# mod_a_maßnahmen_act_rate_5d_to_30d <- icm(param_act_rate_5d_to_30d, init, control)
# 
# plot(mod_a, main="keine Maßnahmen")
# plot(mod_a_maßnahmen_0.5_10d, main="Hygienevorschriften nach 5 Tagen")
# plot(mod_a_maßnahmen_0.5_20d, main="Hygienevorschriftenmen nach 20 Tagen")
# plot(mod_a_maßnahmen_act_rate_5d, main="Kontaktbeschränkungen nach 5 Tagen")
# plot(mod_a_maßnahmen_act_rate_5d_to_30d, main="Kontaktbeschränkungen von Tag 5 bis Tag 30")

```

Beim Ausführen der Funktion erscheint der Fehler :

Error in if (!is.null(dat\$param\$inf.prob.new) && at \>=
dat\$param\$inf.prob.new.start && :
missing value where TRUE/FALSE needed

Deshalb habe ich den Code auskommentiert.

### Alternative Modelle

#### SIS-Modell

Wenn sich Personen nach einer gewissen Zeit erneut anstecken können,
bedeutet das, dass der Zustand "Recovered" nach einer bestimmten Zeit
*t* in den Zustand "Susceptible" übergeht. Das SIS
(Susceptible-Infectious-Susceptible)-Modell wäre in diesem Fall besser,
da es Langzeitimmunität ausschließt.

```{r}

n <- 50
control <- control.icm(type="SIS", nsteps=n)

for (i in seq(2,10,2)){ #vary act rate
  param <- param.icm(inf.prob=inf.prob,
          act.rate=i,
          rec.rate=rec.rate,
          di.rate=I.death_rate,
          ds.rate=S.death_rate,
          dr.rate=S.death_rate,
          a.rate=birth_rate
          )
  
  mod_sis <- icm(param, init, control)
  plot(mod_sis, main=paste("Begegnungsrate pro infizierte Person: ", as.character(i)))
}


for (i in seq(0.02, 0.1, 0.02)){ #vary Infection probability
  param <- param.icm(inf.prob=i,
          act.rate=act.rate,
          rec.rate=rec.rate,
          di.rate=I.death_rate,
          ds.rate=S.death_rate,
          dr.rate=S.death_rate,
          a.rate=birth_rate
          )
  
  mod_sis <- icm(param, init, control)
  plot(mod_sis, main=paste("Infektionswahrscheinlichkeit: ", as.character(i*100), " %"))
}
```

Auch im SIS-Modell flacht die Kurve ab, je niedriger die
Infektionswahrscheinkeit oder die Begegnungsrate ist. Bei einer
Begegnungsrate von 2 Personen ist die Steigung der Infektionskurve
innerhalb der 50-tägigen Simulation nicht wahrnehmbar.

#### Virusvarianten
Im Verlauf der Pandemie gab es zahlreiche verschiedene Virus-Varianten. Was bedeuten diese Varianten für die Modellierung? Wie könnte man ein Modell mit verschiedenen Varianten umsetzen und welche Probleme können sich dabei ergeben?

Die Varianten unterscheiden sich u. a. an der
Ansteckungswahrscheinlichkeit, die Todesrate und Recovery Rate. Um die
Verbreitung von verschiedenen Varianten umzusetzen, müsste man pro
Virus-Variante ein eigenes Modell mit den entsprechenenden Parametern
aufsetzen und sie parallel simulieren. Da die Simulationen im R-Paket
EpiModel isoliert voneinander ausgeführt werden, können bereits
Infizierte einer Variante theoretisch mehrmals infiziert sein, d. h. die
Zustände verschiedener Virusvarianten könnten überlappen.

#### Impfungen
Wie kann man die Impfungen mit einbeziehen? Auf welche Parameter haben Impfungen Einfluss? Sind diese Einflusse konstant?

Impfungen haben Einfluss auf die Ansteckungswahrscheinlichkeit und die
Schwere der Erkrankung, d. h. sie haben auch Einfluss auf die Todesrate
und die Länge der Erkrankung. Da Impfungen nicht konstant vor einer
Ansteckung oder schweren Verlauf schützen, müsste dafür ein geeignete
Modellierung ausgewählt werden, die pro geimpfte Person die Tage nach
Impfung berücksichtigt, d. h. dass die genannten Parameter
(Ansteckungswahrscheinlichkeit & Länge der Erkrankung) sich im Laufe der
Simulation pro Person ändern.
